#!/usr/bin/env ruby

$LOAD_PATH.unshift(File.expand_path(File.dirname(__FILE__) + "/../lib"))
ENV["RACK_ENV"] ||= "development"

require "bundler"
Bundler.require(:default, ENV["RACK_ENV"].to_sym)
require "msworddoc-extractor"
require "dicts"
require_relative '../config/app'
require_relative '../config/initializers/array_hack.rb'

Dir["app/models/*.rb"].each { |file| require_relative "../#{file}" }

EM.synchrony do
  if ENV["FORCE_FLUSH"]
    Homonym.flush
    Segment.flush
    Synonym.flush
    Word.flush
    Hypernym.flush
  end
  # Dicts::Parser::ModernChineseDictParser.new.parse
  puts 'Parsing stopwords...'
  Dicts::Parser::StopwordsParser.new.parse
  puts 'Parsing synonyms...'
  Dicts::Parser::SynonymsDictParser.new.parse
  puts 'Parsing words...'
  Dicts::Parser::WordsDictParser.new.parse
  puts 'Parsing Chinese Pinyin...'
  Dicts::Parser::ChinesePinyinParser.new.parse
  Dicts::Parser::HypernymsDictParser.new.parse
  EM.stop
end
puts 'Dicts parsed successfuly'
